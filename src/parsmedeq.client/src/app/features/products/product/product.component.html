@if (product) {
  <app-header-image
    [backgroundImage]="product.image"
    [bgImageAnimate]="false"
    [contentOffsetToTop]="true"
    [hideMask]="true"
    [contentMinHeight]="400"
    [title]="''"
    [desc]="''">
  </app-header-image>
  <div class="theme-container">
    <div class="py-3">
      <nav class="breadcrumb">فروشگاه › {{ product.productCategoryTitle }} › {{ product.title }}</nav>
      <div fxLayout="row wrap">
        <div class="gallery pe-2" fxFlex="100" fxFlex.gt-md="60">
          <div class="main-image">
            <img [src]="selectedImage" alt="{{ product.title }}" loading="lazy">
          </div>
          <div class="thumbs">
            <button *ngFor="let g of product.images" (click)="selectImage(g)" [class.active]="g.path === selectedImage">
              <img [src]="g.path" alt="thumb" loading="lazy">
            </button>
          </div>
        </div>
        <div class="info ps-2" fxFlex="100" fxFlex.gt-md="40">
          <h1>{{ product.title }}</h1>
          <div class="price-row">
            <div class="price">
              <span class="final">{{ formatPrice(finalPrice(product)) }}</span>
              <span class="original"
                    *ngIf="product.discount && product.discount>0">{{ formatPrice(product.price ?? 0) }}</span>
            </div>
          </div>

          <p class="short-desc" [innerHTML]="product.description | safeHtml"></p>

          @if (product) {
            <app-cart-item-control
              [relatedId]="product!.id"
              [tableId]="Tables.Product"
              [relatedName]="product!.title"
              [unitPrice]="product!.price ?? 0"
              [stock]="product!.stock ?? 99999999">
            </app-cart-item-control>
          }

          <mat-tab-group class="spec-tabs">
            <mat-tab label="توضیحات">
              <div class="tab-body">
                <p [innerHTML]="product.description | safeHtml"></p>
              </div>
            </mat-tab>
            <!--<mat-tab label="مشخصات">
              <div class="tab-body specs">
                <table>
                  <tbody>
                  <tr *ngFor="let s of product.specifications">
                    <td class="key">{{ s.key }}</td>
                    <td class="val">{{ s.value }}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </mat-tab>-->
            <mat-tab label="گالری">
              <div class="tab-body gallery-tab">
                <div class="gallery-grid">
                  <img *ngFor="let g of product.images" [src]="g.path" loading="lazy" alt="">
                </div>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>
      </div>
    </div>
  </div>
} @else {
  <div class="loading container">در حال بارگذاری...</div>
}
