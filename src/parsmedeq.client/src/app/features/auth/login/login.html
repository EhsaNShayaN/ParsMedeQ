<div class="p-3">
  <div class="theme-container">
    <div fxLayout="row" fxLayoutAlign="center center" class="my-3">
      <mat-card appearance="outlined" class="login p-3">
        <div fxLayout="column" fxLayoutAlign="center center" class="text-center">
          <h1 class="uppercase">{{ 'SIGNIN' | translate }}</h1>
        </div>
        @if (error) {
          <div [innerHTML]="error" class="mat-error"></div>
        }
        <form [formGroup]="loginForm" (ngSubmit)="onLoginFormSubmit(loginForm.value)" class="m-7">
          @if (hasMobile) {
            <mat-form-field appearance="outline" class="w-100 mt-1">
              <mat-icon matPrefix class="mr-1 text-muted">lock</mat-icon>
              <mat-label>
                {{ (flag ? 'PASSWORD' : 'CODE') | translate }}
              </mat-label>
              <input matInput [placeholder]="'PASSWORD' | translate" formControlName="password" name="password"
                     [type]="hide || flag ? 'password' : 'text'" class="ltr">
              <mat-error *ngIf="submitted && hasMobile && loginForm.controls['password'].errors?.['required']">
                {{ 'PASSWORD' | translate }} {{ 'IS_REQUIRED' | translate }}
              </mat-error>
              <mat-error
                *ngIf="submitted && hasMobile && loginForm.controls['password'].hasError('minlength')">
                Password isn't long enough, minimum of 6 characters
              </mat-error>
              <button mat-icon-button matSuffix *ngIf="!flag" (click)="hide = !hide" type="button"
                      class="text-muted">
                <mat-icon>{{ hide ? 'visibility_off' : 'visibility' }}</mat-icon>
              </button>
            </mat-form-field>
          } @else {
            <mat-form-field appearance="outline" class="w-100 mt-2">
              <mat-icon matPrefix class="mr-1 text-muted">smartphone</mat-icon>
              <mat-label>{{ 'MOBILE' | translate }}</mat-label>
              <input matInput [placeholder]="'MOBILE' | translate" formControlName="username" name="username"
                     class="ltr" onlyNumber [maxlength]="11" required>
              <mat-error *ngIf="submitted && !hasMobile && loginForm.controls['username'].errors?.['required']">
                {{ 'MOBILE' | translate }} {{ 'IS_REQUIRED' | translate }}
              </mat-error>
              <mat-error
                *ngIf="submitted && !hasMobile && loginForm.controls['username'].hasError('minlength')">
                {{ 'MOBILE_MIN_LENGTH' | translate }}
              </mat-error>
            </mat-form-field>
          }
          <div class="text-center mt-2">
            <button [disabled]="submitClick" mat-raised-button color="accent" class="uppercase" type="submit">
              {{ (!hasMobile ? 'CONTINUE' : 'SIGNIN') | translate }}
            </button>
          </div>
        </form>
        <mat-card-actions fxLayoutAlign="start center">
          @if (hasMobile) {
            <div class="ws-nowrap">
              @if (flag) {
                <button mat-button (click)="check(2)">
                  <mat-icon class="text-muted">lock</mat-icon>
                  <span class="mx-1">{{ 'FORGOT_YOUR_PASSWORD' | translate }}</span>
                </button>
              }
              <button mat-button (click)="back()">
                <mat-icon class="text-muted">smartphone</mat-icon>
                <span class="mx-1">{{ 'CHANGE_MOBILE' | translate }}</span>
              </button>
              @if (flag) {
                <button mat-button (click)="check(1)">
                  <mat-icon class="text-muted">vpn_key</mat-icon>
                  <span class="mx-1">{{ 'ENTER_WITH_OTP' | translate }}</span>
                </button>
              } @else {
                @if (timerTarget === 0) {
                  <button mat-button (click)="sendOtp()">
                    <span class="mx-1">{{ 'RESEND_CODE' | translate }}</span>
                  </button>
                } @else {
                  <app-otp-countdown
                    [target]="timerTarget"
                    [intervalMs]="1000"
                    (finished)="onFinish()">
                  </app-otp-countdown>
                }
              }
            </div>
          }
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
